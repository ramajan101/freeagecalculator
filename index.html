<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgeCalc Pro | Premium UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-body: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #38bdf8;
            --input-bg: #334155;
            --border: #475569;
            --summary-bg: rgba(255, 255, 255, 0.05);
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #0284c7;
            --input-bg: #f8fafc;
            --border: #e2e8f0;
            --summary-bg: #f1f5f9;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: background 0.3s, color 0.3s; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            padding: 40px 20px;
        }

        .app-container { width: 100%; max-width: 850px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }

        .theme-toggle-btn {
            background: var(--card-bg); border: 1px solid var(--border); color: var(--text-primary);
            padding: 10px 18px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 500;
        }

        .main-card {
            background: var(--card-bg); border-radius: 24px; padding: 40px;
            border: 1px solid var(--border); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        .title { font-size: 2rem; margin-bottom: 30px; text-align: center; }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }

        .input-group label { display: block; margin-bottom: 10px; font-weight: 500; font-size: 0.9rem; color: var(--text-secondary); }
        .date-inputs { display: flex; gap: 8px; }
        .date-inputs input {
            width: 100%; background: var(--input-bg); border: 1px solid var(--border);
            color: var(--text-primary); padding: 12px; border-radius: 10px; text-align: center; font-weight: 600; font-size: 1.1rem;
        }

        .calc-button {
            width: 100%; padding: 16px; background: var(--accent); color: white; border: none;
            border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 30px;
        }

        .result-section { display: none; }

        .result-heading { font-size: 1.2rem; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; color: var(--accent); font-weight: 600; }

        .big-numbers { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 35px; text-align: center; }
        .num-box { padding: 20px; background: var(--summary-bg); border-radius: 15px; border: 1px solid var(--border); }
        .num-box .val { font-size: 3rem; font-weight: 800; color: var(--accent); display: block; }
        .num-box .label { font-size: 1rem; color: var(--text-secondary); }

        .summary-list { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .summary-item { display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--summary-bg); border-radius: 12px; font-size: 1rem; }
        .summary-item i { color: var(--accent); width: 20px; height: 20px; }

        .next-birthday-banner { margin-top: 30px; background: linear-gradient(135deg, var(--accent), #6366f1); color: white; padding: 20px; border-radius: 15px; text-align: center; }

        /* Action Buttons */
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .btn-action {
            background: transparent; border: 1px solid var(--border); color: var(--text-primary);
            padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 500;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn-action:hover { background: var(--summary-bg); }

        @media (max-width: 600px) {
            .input-row, .big-numbers, .summary-list, .action-btns { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-theme="dark">

    <div class="app-container">
        <div class="header">
            <div style="font-weight: 700; font-size: 1.4rem;">Age<span style="color:var(--accent)">Calc</span></div>
            <button class="theme-toggle-btn" onclick="toggleTheme()">
                <i data-lucide="moon" id="theme-icon"></i>
                <span id="theme-text">Dark Mode</span>
            </button>
        </div>

        <div class="main-card" id="captureTarget">
            <h1 class="title">Age Calculator</h1>

            <div class="input-row">
                <div class="input-group">
                    <label>Date of Birth</label>
                    <div class="date-inputs">
                        <input type="number" id="bd" placeholder="DD">
                        <input type="number" id="bm" placeholder="MM">
                        <input type="number" id="by" placeholder="YYYY">
                    </div>
                </div>
                <div class="input-group">
                    <label>Age at Date (Today)</label>
                    <div class="date-inputs">
                        <input type="number" id="cd" placeholder="DD">
                        <input type="number" id="cm" placeholder="MM">
                        <input type="number" id="cy" placeholder="YYYY">
                    </div>
                </div>
            </div>

            <button class="calc-button" onclick="calculateAge()">
                <i data-lucide="calculator"></i> Calculate Now
            </button>

            <div class="result-section" id="resultArea">
                <h2 class="result-heading">Calculation Result</h2>
                <div class="big-numbers">
                    <div class="num-box"><span class="val" id="res-y">0</span><span class="label">Years</span></div>
                    <div class="num-box"><span class="val" id="res-m">0</span><span class="label">Months</span></div>
                    <div class="num-box"><span class="val" id="res-d">0</span><span class="label">Days</span></div>
                </div>

                <h2 class="result-heading">Summary Breakdown</h2>
                <div class="summary-list" id="summary-content"></div>

                <div class="next-birthday-banner">
                    <p style="opacity: 0.9; font-size: 0.9rem;">Next Birthday In</p>
                    <h2 id="bday-countdown">0 days left!</h2>
                </div>

                <div class="action-btns">
                    <button class="btn-action" onclick="downloadImage()">
                        <i data-lucide="download"></i> Download Image
                    </button>
                    <button class="btn-action" onclick="shareResult()">
                        <i data-lucide="share-2"></i> Share Result
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const now = new Date();
        document.getElementById('cd').value = now.getDate();
        document.getElementById('cm').value = now.getMonth() + 1;
        document.getElementById('cy').value = now.getFullYear();

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            const icon = document.getElementById('theme-icon');
            icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
            document.getElementById('theme-text').innerText = isDark ? 'Light Mode' : 'Dark Mode';
            lucide.createIcons();
        }

        function calculateAge() {
            const bD = parseInt(document.getElementById('bd').value);
            const bM = parseInt(document.getElementById('bm').value);
            const bY = parseInt(document.getElementById('by').value);
            const cD = parseInt(document.getElementById('cd').value);
            const cM = parseInt(document.getElementById('cm').value);
            const cY = parseInt(document.getElementById('cy').value);

            if(!bD || !bM || !bY) return alert("Please enter Birth Date");

            const birth = new Date(bY, bM - 1, bD);
            const current = new Date(cY, cM - 1, cD);

            let y = current.getFullYear() - birth.getFullYear();
            let m = current.getMonth() - birth.getMonth();
            let d = current.getDate() - birth.getDate();

            if (d < 0) { m--; d += new Date(current.getFullYear(), current.getMonth(), 0).getDate(); }
            if (m < 0) { y--; m += 12; }

            const totalDays = Math.floor((current - birth) / (1000 * 60 * 60 * 24));
            
            let nextBday = new Date(current.getFullYear(), bM - 1, bD);
            if(current > nextBday) nextBday.setFullYear(current.getFullYear() + 1);
            const daysLeft = Math.ceil((nextBday - current) / (1000 * 60 * 60 * 24));

            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('res-y').innerText = y;
            document.getElementById('res-m').innerText = m;
            document.getElementById('res-d').innerText = d;
            document.getElementById('bday-countdown').innerText = `${daysLeft} days left!`;

            const summary = [
                { icon: 'calendar', text: `or ${y * 12 + m} months ${d} days` },
                { icon: 'layers', text: `or ${Math.floor(totalDays/7).toLocaleString()} weeks ${totalDays % 7} days` },
                { icon: 'hash', text: `or ${totalDays.toLocaleString()} days` },
                { icon: 'clock', text: `or ${(totalDays * 24).toLocaleString()} hours` },
                { icon: 'timer', text: `or ${(totalDays * 24 * 60).toLocaleString()} minutes` },
                { icon: 'hourglass', text: `or ${(totalDays * 24 * 3600).toLocaleString()} seconds` }
            ];

            document.getElementById('summary-content').innerHTML = summary.map(item => `
                <div class="summary-item">
                    <i data-lucide="${item.icon}"></i>
                    <span>${item.text}</span>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Fixed Download Function
        async function downloadImage() {
            const captureArea = document.getElementById('captureTarget');
            const canvas = await html2canvas(captureArea, {
                backgroundColor: getComputedStyle(document.body).backgroundColor,
                scale: 2,
                useCORS: true,
                logging: false
            });
            
            const image = canvas.toDataURL("image/png");
            const link = document.createElement('a');
            link.href = image;
            link.download = `AgeResult-${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Share Image Function
        async function shareResult() {
            const captureArea = document.getElementById('captureTarget');
            const canvas = await html2canvas(captureArea, {
                backgroundColor: getComputedStyle(document.body).backgroundColor,
                scale: 2
            });
            
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'AgeResult.png', { type: 'image/png' });
                if (navigator.share) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'My Age Result',
                            text: 'Check out my age calculation summary!'
                        });
                    } catch (err) {
                        console.log("Share failed:", err);
                    }
                } else {
                    alert("Sharing not supported in this browser. Please download the image instead.");
                }
            }, 'image/png');
        }
    </script>
</body>
</html>